{
  "steps": [
    {
      "name": "packages:mise",
      "inputs": [
        {
          "image": "ghcr.io/railwayapp/railpack-builder:latest"
        }
      ],
      "commands": [
        {
          "path": "/mise/shims"
        },
        {
          "path": "/etc/mise/config.toml",
          "name": "mise.toml",
          "customName": "create mise config"
        },
        {
          "cmd": "sh -c 'mise trust -a \u0026\u0026 mise install'",
          "customName": "install mise packages: node, pnpm"
        }
      ],
      "assets": {
        "mise.toml": "[tools]\n  [tools.node]\n    version = \"22.21.1\"\n  [tools.pnpm]\n    version = \"9.15.9\"\n"
      },
      "variables": {
        "MISE_CACHE_DIR": "/mise/cache",
        "MISE_CONFIG_DIR": "/mise",
        "MISE_DATA_DIR": "/mise",
        "MISE_INSTALLS_DIR": "/mise/installs",
        "MISE_NODE_VERIFY": "false",
        "MISE_SHIMS_DIR": "/mise/shims"
      }
    },
    {
      "name": "install",
      "inputs": [
        {
          "step": "packages:mise"
        }
      ],
      "commands": [
        {
          "path": "/app/node_modules/.bin"
        },
        {
          "src": "package.json",
          "dest": "package.json"
        },
        {
          "src": "pnpm-lock.yaml",
          "dest": "pnpm-lock.yaml"
        },
        {
          "src": "prisma",
          "dest": "prisma"
        },
        {
          "cmd": "pnpm install --frozen-lockfile --prefer-offline"
        }
      ],
      "variables": {
        "CI": "true",
        "NODE_ENV": "production",
        "NPM_CONFIG_FUND": "false",
        "NPM_CONFIG_PRODUCTION": "false",
        "NPM_CONFIG_UPDATE_NOTIFIER": "false"
      },
      "caches": [
        "pnpm-install"
      ]
    },
    {
      "name": "build",
      "inputs": [
        {
          "step": "install"
        }
      ],
      "commands": [
        {
          "src": ".",
          "dest": "."
        },
        {
          "cmd": "pnpm run build"
        }
      ],
      "secrets": [
        "*"
      ],
      "variables": {
        "NEXT_TELEMETRY_DISABLED": "1"
      },
      "caches": [
        "node-modules",
        "next"
      ]
    }
  ],
  "caches": {
    "next": {
      "directory": "/app/.next/cache",
      "type": "shared"
    },
    "node-modules": {
      "directory": "/app/node_modules/.cache",
      "type": "shared"
    },
    "pnpm-install": {
      "directory": "/root/.local/share/pnpm/store/v3",
      "type": "shared"
    }
  },
  "deploy": {
    "base": {
      "image": "ghcr.io/railwayapp/railpack-runtime:latest"
    },
    "inputs": [
      {
        "step": "packages:mise",
        "include": [
          "/mise/shims",
          "/mise/installs",
          "/usr/local/bin/mise",
          "/etc/mise/config.toml",
          "/root/.local/state/mise"
        ]
      },
      {
        "step": "build",
        "include": [
          "/app/node_modules"
        ]
      },
      {
        "step": "build",
        "include": [
          "/root/.cache",
          "."
        ],
        "exclude": [
          "node_modules",
          ".yarn"
        ]
      }
    ],
    "startCommand": "pnpm run start",
    "variables": {
      "CI": "true",
      "NODE_ENV": "production",
      "NPM_CONFIG_FUND": "false",
      "NPM_CONFIG_PRODUCTION": "false",
      "NPM_CONFIG_UPDATE_NOTIFIER": "false"
    }
  }
}